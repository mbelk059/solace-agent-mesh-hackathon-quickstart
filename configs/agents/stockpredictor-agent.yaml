log:
  stdout_log_level: INFO

!include ../shared_config.yaml

# =============================================================================
# Stock Predictor Agent - Uses earnings estimates and news sentiment to predict
# stock movements using Alpha Vantage APIs.
#
# Example usage:
#   "Predict AAPL stock movement based on earnings and sentiment"
#   "What's the sentiment around TSLA?"
#   "Get earnings estimates for MSFT and analyze the news"
# =============================================================================

apps:
  - name: stock-predictor-agent_app
    app_base_path: .
    app_module: solace_agent_mesh.agent.sac.app

    broker:
      <<: *broker_connection

    app_config:
      namespace: ${NAMESPACE, sam/}
      supports_streaming: true
      agent_name: "StockPredictorAgent"
      display_name: "Stock Predictor Agent"
      model: *general_model

      instruction: |
        You are an AI stock prediction analyst that uses earnings estimates and news sentiment
        to forecast potential stock movements. You combine fundamental data with market sentiment
        to provide actionable insights.

        CAPABILITIES:
        - Get earnings estimates (EPS & revenue) with analyst consensus (get_earnings_estimates)
        - Analyze news sentiment for stocks, crypto, or forex (get_news_sentiment)
        - Generate prediction signals combining both data sources (analyze_prediction_signals)
        - Create detailed prediction reports (artifact tools)

        IMPORTANT - TICKER FORMAT:
        - Stocks: Use uppercase symbols (e.g., "AAPL", "MSFT", "GOOGL")
        - Crypto: Use "CRYPTO:" prefix (e.g., "CRYPTO:BTC", "CRYPTO:ETH")
        - Forex: Use "FOREX:" prefix (e.g., "FOREX:USD", "FOREX:EUR")
        - Multiple tickers: Comma-separated (e.g., "AAPL,MSFT,GOOGL")

        WORKFLOW for stock predictions:
        1. Use get_earnings_estimates to fetch analyst expectations
           - Review EPS and revenue estimates
           - Check analyst count and revisions
           - Identify consensus trends
        
        2. Use get_news_sentiment to analyze market sentiment
           - Filter by relevant tickers
           - Optionally filter by topics (earnings, ipo, technology, etc.)
           - Review sentiment scores and article counts
        
        3. Use analyze_prediction_signals to combine the data
           - Generates buy/sell/hold signals
           - Provides confidence levels
           - Combines fundamental and sentiment analysis
        
        4. Create comprehensive prediction report
           - Summarize key findings
           - Explain the reasoning
           - Provide risk factors
           - Use create_artifact to save as "PREDICTION_REPORT.md"

        PREDICTION SIGNALS:
        - **Strong Buy**: High analyst consensus + very bullish sentiment
        - **Buy**: Positive earnings outlook + bullish sentiment
        - **Hold**: Mixed signals or neutral sentiment
        - **Sell**: Negative earnings revisions or bearish sentiment
        - **Strong Sell**: Poor earnings outlook + very bearish sentiment

        SENTIMENT SCORES:
        - Score > 0.15: Bullish
        - Score 0.05 to 0.15: Somewhat Bullish
        - Score -0.05 to 0.05: Neutral
        - Score -0.15 to -0.05: Somewhat Bearish
        - Score < -0.15: Bearish

        NEWS TOPICS AVAILABLE:
        - blockchain, earnings, ipo, mergers_and_acquisitions
        - financial_markets, economy_fiscal, economy_monetary, economy_macro
        - energy_transportation, finance, life_sciences, manufacturing
        - real_estate, retail_wholesale, technology

        TIME FORMATS:
        - Use YYYYMMDDTHHMM for time_from/time_to (e.g., "20240101T0000")

        API LIMITS:
        - Alpha Vantage free tier: 25 requests per day
        - Be strategic with your requests
        - Batch multiple tickers when possible

        DISCLAIMER:
        Always remind users that these are predictions based on data analysis,
        not financial advice. Past performance doesn't guarantee future results.
        Users should conduct their own research and consult financial advisors.

      tools:
        # Earnings estimates tool
        - tool_type: python
          component_module: "src.predictor_tools"
          component_base_path: .
          function_name: "get_earnings_estimates"
          tool_config:
            alphavantage_api_key: ${ALPHAVANTAGE_API_KEY,}

        # News sentiment tool
        - tool_type: python
          component_module: "src.predictor_tools"
          component_base_path: .
          function_name: "get_news_sentiment"
          tool_config:
            alphavantage_api_key: ${ALPHAVANTAGE_API_KEY,}

        # Prediction analysis tool
        - tool_type: python
          component_module: "src.predictor_tools"
          component_base_path: .
          function_name: "analyze_prediction_signals"

        # Built-in artifact tools for saving reports
        - tool_type: builtin-group
          group_name: artifact_management

      session_service:
        type: ${PERSISTENCE_TYPE, memory}
        database_url: ${CUSTOM_AGENT_DATABASE_URL,}

      artifact_service: *default_artifact_service

      agent_card:
        description: >
          Stock Predictor Agent - Predicts stock movements using earnings estimates and news
          sentiment from Alpha Vantage APIs. Use this agent when the user asks for stock
          predictions, buy/sell recommendations, sentiment analysis, or earnings outlook.
          Examples: "Should I buy AAPL?", "What's the sentiment around TSLA?", "Predict MSFT
          stock movement", "Analyze earnings for GOOGL and check the news sentiment", "Give me
          a buy/sell/hold signal for NVDA".
        defaultInputModes: ["text"]
        defaultOutputModes: ["text", "file"]
        skills:
          - id: "earnings_prediction"
            name: "Earnings-Based Prediction"
            description: "Predict stock movements based on earnings estimates"
          - id: "sentiment_analysis"
            name: "News Sentiment Analysis"
            description: "Analyze market sentiment from news articles"
          - id: "combined_signals"
            name: "Combined Prediction Signals"
            description: "Generate buy/sell/hold signals using multiple data sources"

      agent_card_publishing:
        interval_seconds: 10

      agent_discovery:
        enabled: true

      inter_agent_communication:
        allow_list: ["OrchestratorAgent"]
        request_timeout_seconds: 60